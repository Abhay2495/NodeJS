<!DOCTYPE html>
<html>

<head>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        .chkOption {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #0d6efd;
            /* modern browsers */
        }
    </style>
</head>

<body>

    <script>

        var thePage = 0;
        var questionPerPage = 10;
        var InitialQuestions = [];


        function getSelectedAssessmentQuestions(questions) {
            let selectedQuestions = questions.filter((question) => (question.selected === true));
            return selectedQuestions;
        }



        function onCheckBoxChanged() {
            let checkboxId = this.id;
            let currentQuestionIndex = checkboxId - 1;
            let checkboxValue = this.value;
            let isChecked = this.checked;
            let questions = JSON.parse(localStorage.getItem("testQuestions"));
            questions[currentQuestionIndex].selected = isChecked;
            localStorage.setItem("testQuestions", JSON.stringify(questions));
            let selectedQuestionsCount =  questions.filter((question) => (question.selected === true)).length;
            console.log(selectedQuestionsCount);
        }
        
        function loadQuestions() {
            $.ajax({
                url: "http://localhost:5238/api/questionbank/questions",
                method: "GET",
                success: function (data) {
                    InitialQuestions = data;
                    localStorage.setItem("testQuestions", JSON.stringify(InitialQuestions));
                    refershQuestionList(thePage);
                },
            });
        }
        loadQuestions();

        function refershQuestionList(pageCount) {
            //var divQuestionList = $("#divQuestions");
            if ($("#divQuestions").children().length !== 0) {
                $("#divQuestions").empty();
            }
            let questions = JSON.parse(localStorage.getItem("testQuestions"));
            let questionsPerPage = questions.slice(pageCount * questionPerPage, pageCount * questionPerPage + questionPerPage);

            questionsPerPage.map((question) => {
                let questionCheckBox = "<input type='checkbox' class='chkOption'" + "id=" + question.id + " " + (question.selected ? "checked" : "") + " /> " + question.title;
                $("#divQuestions").append(questionCheckBox).append('<br/>');
                //if event  is already attached , don't attach
                $(".chkOption").off("change").on("change", onCheckBoxChanged);
            });
        }


        $(document).ready(function () {
            let qts = JSON.parse(localStorage.getItem("testQuestions"));
            $("button").on("click", function (e) {
                var btnId = e.currentTarget.id;
               
                switch (btnId) {
                    case "btnFirst":
                        thePage = 0;
                        refershQuestionList(thePage);
                        $("#btnPrevious").prop("disabled", true);
                        $("#btnNext").prop("disabled", false);
                        break;

                    case "btnPrevious":
                        thePage--;
                       
                        $("#divQuestionList").empty();
                        refershQuestionList(thePage);
                        $("#btnNext").prop("disabled", false);
                        break;

                    case "btnNext":
                        thePage++;
                       
                        $("#divQuestionList").empty();
                        refershQuestionList(thePage);
                        $("#btnPrevious").prop("disabled", false);
                        break;

                    case "btnLast":
                        thePage = (InitialQuestions.length / questionPerPage) - 1;
                       
                        $("#divQuestionList").empty();
                        refershQuestionList(thePage);
                        $("#btnNext").prop("disabled", true);
                        $("#btnPrevious").prop("disabled", false);
                        break;

                    case "btnSelect": {
                        let questions = JSON.parse(localStorage.getItem("testQuestions"));
                        questions[0].selected = false;
                        localStorage.setItem("testQuestions", JSON.stringify(questions));
                        
                        $("#divQuestions").empty();
                        refershQuestionList();
                    }
                        break;
                }
            });



            var btnClickme = $('#btnTestCart');
            btnClickme.click(() => {
                let questions = JSON.parse(localStorage.getItem("testQuestions"));
                let selectedQuetions = questions.filter((question) => (question.selected === true));;
                let divQuestionsCart = $("#divQuestionCart");
                divQuestionsCart.empty();
                selectedQuetions.map((question) => {
                    let para = "<p>" + question.title + "</p>";
                    divQuestionsCart.append(para);
                });
            });
        });

    </script>



    <div id="divQuestions">

    </div>

    <hr />
    <button id="btnTestCart"> QuestionCart </button>
    <hr />

    <button id="btnFirst"> First</button> | <button id="btnPrevious"> Previous</button>|<button id="btnNext">
        Next</button> |<button id="btnLast"> Last</button>



    <div id="divQuestionCart">

    </div>

</body>

</html>